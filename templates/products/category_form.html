{% extends "base.html" %}
{% block page_title %}<h5>{{ title }}</h5>{% endblock %}

{% block content %}
<div class="toss-card" style="max-width:600px">
    <div class="card-body">
        <form method="post">
            {% csrf_token %}

            <div class="mb-3">
                <label class="toss-label">카테고리명</label>
                {{ form.name }}
                {% if form.name.errors %}<div style="color:var(--toss-red);font-size:12px;margin-top:4px">{{ form.name.errors.0 }}</div>{% endif %}
            </div>

            <div class="mb-3">
                <label class="toss-label">아이콘 선택</label>
                <input type="hidden" name="{{ form.icon.html_name }}" id="{{ form.icon.id_for_label }}" value="{{ form.icon.value|default:'' }}">
                <div id="iconPreview" style="font-size:36px;color:var(--toss-blue);text-align:center;padding:12px 0;min-height:60px">
                    <i class="bi {{ form.icon.value|default:'bi-grid' }}"></i>
                </div>
                <div id="iconGrid" style="display:grid;grid-template-columns:repeat(8,1fr);gap:6px;max-height:260px;overflow-y:auto;padding:4px"></div>
                {% if form.icon.errors %}<div style="color:var(--toss-red);font-size:12px;margin-top:4px">{{ form.icon.errors.0 }}</div>{% endif %}
            </div>

            <div class="mb-3">
                <label class="toss-label">표시 순서</label>
                {{ form.display_order }}
                {% if form.display_order.errors %}<div style="color:var(--toss-red);font-size:12px;margin-top:4px">{{ form.display_order.errors.0 }}</div>{% endif %}
            </div>

            <div class="mb-3">
                <div class="form-check">
                    {{ form.is_active }}
                    <label class="form-check-label" style="font-size:14px;font-weight:500">활성</label>
                </div>
            </div>

            <div class="d-flex gap-2">
                <button type="submit" class="btn-toss btn-toss-primary">저장</button>
                <a href="{% url 'products:category_list' %}" class="btn-toss btn-toss-light">취소</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
(function() {
    const icons = [
        'bi-geo-alt','bi-shop','bi-bag','bi-cart',
        'bi-phone','bi-envelope','bi-camera','bi-image','bi-film',
        'bi-music-note','bi-headphones','bi-mic','bi-tv','bi-laptop',
        'bi-printer','bi-cpu','bi-hdd','bi-usb-drive','bi-mouse',
        'bi-keyboard','bi-watch','bi-battery-full','bi-lightbulb','bi-tools',
        'bi-wrench','bi-hammer','bi-scissors','bi-brush','bi-palette',
        'bi-gem','bi-gift','bi-heart','bi-star','bi-trophy',
        'bi-flag','bi-bookmark','bi-tag','bi-box','bi-archive','bi-receipt',
        'bi-instagram','bi-facebook','bi-twitter-x','bi-youtube','bi-tiktok','bi-threads','bi-snapchat','bi-discord',
    ];
    const hiddenInput = document.getElementById('{{ form.icon.id_for_label }}');
    const preview = document.getElementById('iconPreview');
    const grid = document.getElementById('iconGrid');
    const currentVal = hiddenInput.value.trim();

    icons.forEach(cls => {
        const cell = document.createElement('div');
        cell.style.cssText = 'display:flex;align-items:center;justify-content:center;font-size:20px;padding:8px;border-radius:8px;cursor:pointer;border:2px solid transparent;transition:all .15s';
        cell.innerHTML = `<i class="bi ${cls}"></i>`;
        cell.dataset.icon = cls;
        if (cls === currentVal) {
            cell.style.borderColor = 'var(--toss-blue)';
            cell.style.background = 'rgba(51,102,255,.08)';
        }
        cell.addEventListener('click', () => {
            grid.querySelectorAll('div').forEach(d => { d.style.borderColor = 'transparent'; d.style.background = ''; });
            cell.style.borderColor = 'var(--toss-blue)';
            cell.style.background = 'rgba(51,102,255,.08)';
            hiddenInput.value = cls;
            preview.innerHTML = `<i class="bi ${cls}"></i>`;
        });
        grid.appendChild(cell);
    });
})();
</script>
{% endblock %}
